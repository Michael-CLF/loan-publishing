<!-- balloon-calc.component.html -->
<div class="calculator-container">
    <h2 class="title">Balloon Payment Calculator</h2>

    <form [formGroup]="balloonForm" (ngSubmit)="calculateBalloonPayment()">
        <div class="form-group">
            <label for="loanAmount">Loan Amount ($)</label>
            <div class="input-group">
                <input type="number" id="loanAmount" formControlName="loanAmount" class="form-control"
                    [class.is-invalid]="balloonForm.get('loanAmount')?.invalid && balloonForm.get('loanAmount')?.touched">
            </div>
            @if (balloonForm.get('loanAmount')?.hasError('required') && balloonForm.get('loanAmount')?.touched) {
            <div class="error-message">Loan amount is required</div>
            }
            @if (balloonForm.get('loanAmount')?.hasError('min') && balloonForm.get('loanAmount')?.touched) {
            <div class="error-message">Loan amount must be greater than 0</div>
            }
        </div>

        <div class="form-group">
            <label for="interestRate">Annual Interest Rate (%)</label>
            <input type="number" id="interestRate" formControlName="interestRate" class="form-control" step="0.01"
                [class.is-invalid]="balloonForm.get('interestRate')?.invalid && balloonForm.get('interestRate')?.touched">
            @if (balloonForm.get('interestRate')?.hasError('required') && balloonForm.get('interestRate')?.touched) {
            <div class="error-message">Interest rate is required</div>
            }
            @if (balloonForm.get('interestRate')?.hasError('min') && balloonForm.get('interestRate')?.touched) {
            <div class="error-message">Interest rate must be greater than 0</div>
            }
        </div>

        <div class="form-group">
            <label for="loanTermYears">Loan Term (Years)</label>
            <input type="number" id="loanTermYears" formControlName="loanTermYears" class="form-control"
                [class.is-invalid]="balloonForm.get('loanTermYears')?.invalid && balloonForm.get('loanTermYears')?.touched">
            @if (balloonForm.get('loanTermYears')?.hasError('required') && balloonForm.get('loanTermYears')?.touched) {
            <div class="error-message">Loan term is required</div>
            }
            @if (balloonForm.get('loanTermYears')?.hasError('min') && balloonForm.get('loanTermYears')?.touched) {
            <div class="error-message">Loan term must be at least 1 year</div>
            }
        </div>

        <div class="form-group">
            <label for="balloonTermYears">Balloon Term (Years)</label>
            <input type="number" id="balloonTermYears" formControlName="balloonTermYears" class="form-control"
                [class.is-invalid]="(balloonForm.get('balloonTermYears')?.invalid || balloonForm.hasError('balloonTermTooLong')) && balloonForm.get('balloonTermYears')?.touched">
            @if (balloonForm.get('balloonTermYears')?.hasError('required') &&
            balloonForm.get('balloonTermYears')?.touched) {
            <div class="error-message">Balloon term is required</div>
            }
            @if (balloonForm.get('balloonTermYears')?.hasError('min') && balloonForm.get('balloonTermYears')?.touched) {
            <div class="error-message">Balloon term must be at least 1 year</div>
            }
            @if (balloonForm.hasError('balloonTermTooLong') && balloonForm.get('balloonTermYears')?.touched) {
            <div class="error-message">Balloon term must be less than the loan term</div>
            }
        </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary" [disabled]="balloonForm.invalid">Calculate</button>
            <button type="button" class="btn btn-secondary" (click)="resetCalculator()">Reset</button>
        </div>
    </form>

    @if (result) {
    <div class="results-container">
        <h3>Calculation Results</h3>

        <div class="result-summary">
            <div class="result-item">
                <span class="result-label">Monthly Payment:</span>
                <span class="result-value">{{formatAsCurrency(result.regularPayment)}}</span>
            </div>

            <div class="result-item">
                <span class="result-label">Total Interest Paid:</span>
                <span class="result-value">{{formatAsCurrency(result.totalInterest)}}</span>
            </div>

            <div class="result-item highlight">
                <span class="result-label">Balloon Payment:</span>
                <span class="result-value">{{formatAsCurrency(result.balloonPayment)}}</span>
            </div>
        </div>

        <h4>Amortization Schedule</h4>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Payment #</th>
                        <th>Payment Amount</th>
                        <th>Principal</th>
                        <th>Interest</th>
                        <th>Remaining Balance</th>
                    </tr>
                </thead>
                <tbody>
                    @for (payment of result.amortizationSchedule; track payment.paymentNumber) {
                    <tr>
                        <td>{{payment.paymentNumber}}</td>
                        <td>{{formatAsCurrency(payment.paymentAmount)}}</td>
                        <td>{{formatAsCurrency(payment.principalPaid)}}</td>
                        <td>{{formatAsCurrency(payment.interestPaid)}}</td>
                        <td>{{formatAsCurrency(payment.remainingBalance)}}</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    }
</div>
<div class="contact-container">
    <h2 class="contact-title">Ready to post your first loan scenario?</h2>
    <button (click)="openRoleSelectionModal()" class="calc-btn" class="register-btn">Register</button>
</div>