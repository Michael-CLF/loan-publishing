<!-- lender-footprint.component.html -->
<div class="states-section" [formGroup]="lenderForm">
    <h4>Lending Footprint</h4>
    <p class="helper-text">Select all states where you actively lend</p>
    <p class="warning">NOTE: You can also choose specific counties within a state.</p>

    <!-- Top controls -->
    <div class="states-header">
        <label class="checkbox-wrapper select-all-states">
            <input type="checkbox" id="toggle-all-states" [checked]="areAllStatesSelected()"
                (change)="toggleAllStates()" />
            <span>Select All States</span>
        </label>
    </div>

    <!-- States Grid -->
    <div class="states-grid">
        <div class="state-card" *ngFor="let st of footprintLocation" [class.selected]="isStateSelected(st.value)">
            <!-- State Row -->
            <div class="state-header" (click)="toggleState(st.value)">
                <div class="checkbox-wrapper">
                    <input type="checkbox" [id]="'state-' + st.value" [checked]="isStateSelected(st.value)"
                        (change)="toggleState(st.value)" />
                    <span class="state-name">{{ st.name }}</span>
                </div>

                <span class="county-count" *ngIf="isStateSelected(st.value)">
                    {{ getSelectedCountiesCount(st.value) }} /
                    {{ st.subcategories.length }}
                </span>
            </div>

            <!-- Expand / Collapse counties -->
            <div class="dropdown-toggle" *ngIf="isStateSelected(st.value) && st.subcategories?.length"
                (click)="toggleDropdown(st.value)">
                <span class="toggle-text">
                    {{ expandedState === st.value ? 'Hide Counties' : 'Show Counties' }}
                </span>
                <span class="toggle-icon">
                    {{ expandedState === st.value ? '▲' : '▼' }}
                </span>
            </div>
        </div>
    </div>

    <!-- Counties Section -->
    <div class="counties-section" *ngFor="let st of footprintLocation"
        [class.expanded]="expandedState === st.value && isStateSelected(st.value)">
        <ng-container *ngIf="expandedState === st.value && isStateSelected(st.value)">
            <div class="counties-header">
                <h5>{{ st.name }} Counties</h5>
                <div class="select-all-counties">
                    <label>
                        <input type="checkbox" [checked]="isAllCountiesSelected(st.value)"
                            (change)="toggleAllCounties(st.value)" />
                        <span>Select All Counties</span>
                    </label>
                </div>
            </div>

            <div class="counties-grid">
                <div class="county-item" *ngFor="let county of st.subcategories"
                    [class.selected]="isCountySelected(st.value, county.value)">
                    <label class="county-header">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" [id]="'county-' + st.value + '-' + county.value"
                                [checked]="isCountySelected(st.value, county.value)"
                                (change)="toggleCounty(st.value, county.value)" />
                            <span>{{ county.name }}</span>
                        </div>
                    </label>
                </div>
            </div>
        </ng-container>
    </div>

    <!-- Error message if no states selected -->
    <div class="error-message" *ngIf="hasFormError('noStateSelected')">
        Please select at least one state.
    </div>
</div>