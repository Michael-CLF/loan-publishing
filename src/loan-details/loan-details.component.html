<!-- loan-details.component.html -->
<div class="loan-details-container">
    <header class="loan-header">
        <button class="back-btn" (click)="goBack()">‚Üê Back to all Loans</button>
    </header>

    <!-- Authentication check -->
    <div *ngIf="!isAuthenticated()" class="auth-message">
        <p>You must be logged in to view loan details.</p>
        <button class="login-btn" routerLink="/login">Log In</button>
    </div>

    <!-- Content only visible to authenticated users -->
    <ng-container *ngIf="isAuthenticated()">
        <!-- Loading state -->
        <div *ngIf="isLoading()" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading loan details...</p>
        </div>

        <!-- Error message -->
        <div *ngIf="errorMessage()" class="error-message">
            {{ errorMessage() }}
            <button class="retry-btn" (click)="retryLoadLoan()">Retry</button>
        </div>

        <!-- Loan details -->
        <div *ngIf="!isLoading() && loan()" class="loan-details-card">
            <div class="loan-type-header" [style.backgroundColor]="getColor(loan()?.propertyTypeCategory || '')">
                <h2 class="loan-category">{{ loan()?.propertyTypeCategory }}</h2>
            </div>

            <div class="loan-details-content">
                <div class="detail-section">
                    <h3 class="section-title">Property Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Property Type:</span>
                        <span class="detail-value">{{ loan()?.propertyTypeCategory }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Sub Category:</span>
                        <span class="detail-value">{{ loan()?.propertySubCategory }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Location:</span>
                        <span class="detail-value">{{ loan()?.state }}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="section-title">Loan Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Loan Type:</span>
                        <span class="detail-value">{{ loan()?.loanType | titlecase }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Loan Amount:</span>
                        <span class="detail-value highlight">{{ formatCurrency(loan()?.loanAmount || '') }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">LTV:</span>
                        <span class="detail-value">{{ loan()?.ltv }}%</span>
                    </div>
                </div>

                <!-- Only include this section if notes exist -->
                <div class="detail-section" *ngIf="loan()?.notes">
                    <h3 class="section-title">Notes</h3>
                    <p class="description">{{ loan()?.notes }}</p>
                </div>

                <div class="detail-section">
                    <h3 class="section-title">Requested On</h3>
                    <div class="detail-row">
                        <span class="detail-label">Created:</span>
                        <span class="detail-value">{{ getFormattedDate(loan()?.createdAt) }}</span>
                    </div>
                    <div class="detail-row" *ngIf="loan()?.updatedAt">
                        <span class="detail-label">Last Updated:</span>
                        <span class="detail-value">{{ getFormattedDate(loan()?.updatedAt) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty state if loan is null but not loading -->
        <div *ngIf="!isLoading() && !loan() && !errorMessage()" class="empty-state">
            <p>This loan does not exist or has been removed.</p>
            <button class="back-btn" (click)="goBack()">Back to Loans</button>
        </div>
    </ng-container>
</div>